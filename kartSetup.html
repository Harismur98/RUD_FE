<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">
    <title>RUD TIMING SOFTWARE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="src/css/style.css">
</head>
<body>
    <header class="header_bar">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-md-2 d-flex align-items-center">
                    <div class="d-flex align-items-center">
                        <div class="logo d-flex align-items-center justify-content-center text-white fw-bold" style="font-size: 12px;">
                            RACING<br>UNDERDOGâ„¢
                        </div>
                    </div>
                </div>
                <div class="col-md-8 text-center">
                    <h1 class="m-0 fw-bold" style="font-size: 28px; letter-spacing: 2px;">RUD TIMING SOFTWARE</h1>
                </div>
                <div class="col-md-2 d-flex justify-content-end align-items-center gap-3">
                    <select class="form-select form-select-sm bg-dark text-white" style="width: 60px; font-size: 12px;">
                        <option value="en" selected>EN</option>
                        <option value="my">MY</option>
                    </select>
                    <label class="switch">
                        <input type="checkbox" checked>
                        <span class="slider round">Socket</span>
                    </label>
                </div>
            </div>
        </div>
    </header>

    <div class="app_shell">
        <div class="app_row">
            <aside class="sidebar">
                <div class="sidebar_time">
                    <div id="date" style="font-size:12px;"></div>
                    <div id="clock" style="font-size:22px;"></div>
                </div>
                <nav class="flex-grow-1">
                    <ul class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="index.html"><i class="bi bi-people-fill"></i> Group Session</a></li>
                        <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-display"></i> Displays</a></li>
                        <li class="nav-item"><a class="nav-link" href="result.html"><i class="bi bi-bar-chart-line-fill"></i> Results</a></li>
                        <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-cpu"></i> Device Control</a></li>
                        <li class="nav-item"><a class="nav-link active" href="#"><i class="bi bi-gear-fill"></i> Kart Setup</a></li>
                        <li class="nav-item"><a class="nav-link" href="setting.html"><i class="bi bi-sliders2-vertical"></i> System Setting</a></li>
                    </ul>
                </nav>
                <div class="text-center text-muted small pb-3">
                    <div>V 2.1.2</div>
                    <div>About Us</div>
                </div>
            </aside>

            <main class="main-content main_content_layout">
                <div class="app_row">
                    <!-- Left Panel - Groups -->
                    <div class="kart_groups_panel thick_border_end">
                        <div class="kart_groups_header">
                            <div class="search_bar">
                                <i class="bi bi-search"></i>
                                <input type="text" placeholder="Kart No." class="form-control">
                            </div>
                        </div>
                        
                        <div class="kart_groups_content">
                            <!-- Test Group -->
                            <div class="kart_group_item">
                                <div class="group_header" onclick="toggleGroup(this)">
                                    <i class="bi bi-chevron-down chevron"></i>
                                    <span class="group_name">tea group (2)</span>
                                    <div class="group_actions">
                                        <button class="btn_icon"><i class="bi bi-plus"></i></button>
                                        <button class="btn_icon"><i class="bi bi-three-dots-vertical"></i></button>
                                    </div>
                                </div>
                                <div class="group_items">
                                    <div class="kart_item">
                                        <span class="kart_info">No.kar... KID2.0</span>
                                        <span class="status_badge empty">Empty</span>
                                        <button class="btn_icon"><i class="bi bi-three-dots-vertical"></i></button>
                                    </div>
                                    <div class="kart_item">
                                        <span class="kart_info">No.kar... KID2.0</span>
                                        <span class="status_badge empty">Empty</span>
                                        <button class="btn_icon"><i class="bi bi-three-dots-vertical"></i></button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Test Group 2 -->
                            <div class="kart_group_item">
                                <div class="group_header" onclick="toggleGroup(this)">
                                    <i class="bi bi-chevron-down chevron"></i>
                                    <span class="group_name">Test Group 2 (1)</span>
                                    <div class="group_actions">
                                        <button class="btn_icon"><i class="bi bi-plus"></i></button>
                                        <button class="btn_icon"><i class="bi bi-three-dots-vertical"></i></button>
                                    </div>
                                </div>
                                <div class="group_items">
                                    <div class="kart_item">
                                        <span class="kart_info">No.G2... RUNNING2.0</span>
                                        <span class="status_badge empty">Empty</span>
                                        <button class="btn_icon"><i class="bi bi-three-dots-vertical"></i></button>
                                    </div>
                                </div>
                            </div>

                            <div class="kart_group_item">
                                <div class="group_header" onclick="toggleGroup(this)">
                                    <i class="bi bi-chevron-down chevron"></i>
                                    <span class="group_name">Test Group 2 (1)</span>
                                    <div class="group_actions">
                                        <button class="btn_icon"><i class="bi bi-plus"></i></button>
                                        <button class="btn_icon"><i class="bi bi-three-dots-vertical"></i></button>
                                    </div>
                                </div>
                                <div class="group_items">
                                    <div class="kart_item">
                                        <span class="kart_info">No.G2... RUNNING2.0</span>
                                        <span class="status_badge empty">Empty</span>
                                        <button class="btn_icon"><i class="bi bi-three-dots-vertical"></i></button>
                                    </div>
                                    <div class="kart_item">
                                        <span class="kart_info">No.G2... RUNNING2.0</span>
                                        <span class="status_badge empty">Empty</span>
                                        <button class="btn_icon"><i class="bi bi-three-dots-vertical"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="add_group_section">
                            <button class="btn_add_group" data-bs-toggle="modal" data-bs-target="#add_kart_group">
                                <i class="bi bi-plus"></i>
                                Add Kart Group
                            </button>
                        </div>
                    </div>

                    <!-- Right Panel - Kart Details -->
                    <div class="kart_details_panel">
                        <div class="kart_details_header">
                            <div class="header_controls">
                                <div class="filter_dropdowns">
                                    <select class="form-select">
                                        <option>All Status</option>
                                        <option>Empty</option>
                                        <option>Running</option>
                                    </select>
                                    <select class="form-select">
                                        <option>All Types</option>
                                    </select>
                                </div>
                                <div class="action_buttons">
                                    <button class="btn btn_custom">Refresh</button>
                                    <button class="btn btn_custom" data-bs-toggle="modal" data-bs-target="#add_kart">Add Kart</button>
                                    <button class="btn btn_custom" data-bs-toggle="modal" data-bs-target="#set_model">Set Model</button>
                                    <button class="btn btn_custom">Import kart</button>
                                    <button class="btn btn_custom">Export Kart</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="kart_details_content">
                            <!-- Test Group Cards -->
                            <div class="group_section">
                                <h6 class="group_section_title">test group(2)</h6>
                                <div class="kart_cards_grid">
                                    <div class="kart_card">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA2MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNCIgZmlsbD0iIzMzMzMzMyIvPgo8Y2lyY2xlIGN4PSIxNSIgY3k9IjMwIiByPSI1IiBmaWxsPSIjNjY2NjY2Ii8+CjxjaXJjbGUgY3g9IjQ1IiBjeT0iMzAiIHI9IjUiIGZpbGw9IiM2NjY2NjYiLz4KPHJlY3QgeD0iMTAiIHk9IjE1IiB3aWR0aD0iNDAiIGhlaWdodD0iMTAiIHJ4PSIyIiBmaWxsPSIjNTU1NTU1Ii8+Cjx0ZXh0IHg9IjMwIiB5PSIyMiIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5LQVJUPC90ZXh0Pgo8L3N2Zz4K" alt="Kart" class="kart_image">
                                        <div class="kart_card_info">
                                            <div class="kart_number">Kart No.kart1</div>
                                            <div class="kart_model">KID2.0</div>
                                            <div class="card_id">Card Id:1</div>
                                        </div>
                                        <span class="status_badge empty">Empty</span>
                                    </div>
                                    
                                    <div class="kart_card">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA2MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNCIgZmlsbD0iIzMzMzMzMyIvPgo8Y2lyY2xlIGN4PSIxNSIgY3k9IjMwIiByPSI1IiBmaWxsPSIjNjY2NjY2Ii8+CjxjaXJjbGUgY3g9IjQ1IiBjeT0iMzAiIHI9IjUiIGZpbGw9IiM2NjY2NjYiLz4KPHJlY3QgeD0iMTAiIHk9IjE1IiB3aWR0aD0iNDAiIGhlaWdodD0iMTAiIHJ4PSIyIiBmaWxsPSIjNTU1NTU1Ii8+Cjx0ZXh0IHg9IjMwIiB5PSIyMiIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5LQVJUPC90ZXh0Pgo8L3N2Zz4K" alt="Kart" class="kart_image">
                                        <div class="kart_card_info">
                                            <div class="kart_number">Kart No.Kar...</div>
                                            <div class="kart_model">KID2.0</div>
                                            <div class="card_id">Card Id:2</div>
                                        </div>
                                        <span class="status_badge empty">Empty</span>
                                    </div>                                   
                                </div>
                            </div>
                            
                            <!-- Test Group 2 Cards -->
                            <div class="group_section">
                                <h6 class="group_section_title">Test Group 2(1)</h6>
                                <div class="kart_cards_grid">
                                    <div class="kart_card">
                                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA2MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNCIgZmlsbD0iIzMzMzMzMyIvPgo8Y2lyY2xlIGN4PSIxNSIgY3k9IjMwIiByPSI1IiBmaWxsPSIjNjY2NjY2Ii8+CjxjaXJjbGUgY3g9IjQ1IiBjeT0iMzAiIHI9IjUiIGZpbGw9IiM2NjY2NjYiLz4KPHJlY3QgeD0iMTAiIHk9IjE1IiB3aWR0aD0iNDAiIGhlaWdodD0iMTAiIHJ4PSIyIiBmaWxsPSIjNTU1NTU1Ii8+Cjx0ZXh0IHg9IjMwIiB5PSIyMiIgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSI4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5LQVJUPC90ZXh0Pgo8L3N2Zz4K" alt="Kart" class="kart_image">
                                        <div class="kart_card_info">
                                            <div class="kart_number">Kart No.G2 ...</div>
                                            <div class="kart_model">RUNNING2.0</div>
                                            <div class="card_id">Card Id:12234</div>
                                        </div>
                                        <span class="status_badge empty">Empty</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal -->
                <!-- add kart -->
                <div class="modal fade" id="add_kart" aria-labelledby="addkart" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="addkart">Add Kart</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">* Kart Name</label>
                                        <input type="text" class="form-control" placeholder="Enter kart name" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">* Kart Num</label>
                                        <input type="text" class="form-control" placeholder="Enter kart number" required>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-8 mb-3">
                                        <label class="form-label">* Brand</label>
                                        <div class="d-flex flex-wrap gap-2">
                                            <button type="button" class="btn btn_custom">test</button>
                                        </div>
                                        
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">* Kart Type</label>
                                    <div class="d-flex flex-wrap gap-2">
                                        <button type="button" class="btn btn-outline-secondary kart-type-btn" data-type="KID2.0">KID2.0</button>
                                        <button type="button" class="btn btn-outline-secondary kart-type-btn" data-type="BABY2.0">BABY2.0</button>
                                        <button type="button" class="btn btn-outline-secondary kart-type-btn" data-type="RUNNING2.0">RUNNING2.0</button>
                                        <button type="button" class="btn btn-outline-secondary kart-type-btn" data-type="MINI">MINI</button>
                                        <button type="button" class="btn btn-outline-secondary kart-type-btn" data-type="DOUBLE">DOUBLE</button>
                                    </div>
                                    <input type="hidden" id="selected-kart-type" name="kart-type" required>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">* Kart Group</label>
                                    <select class="form-select" required>
                                        <option value="">Please choose</option>
                                        <option value="test-group">Test Group</option>
                                        <option value="test-group-2">Test Group 2</option>
                                        <option value="racing-group">Racing Group</option>
                                        <option value="training-group">Training Group</option>
                                    </select>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">* Card No.</label>
                                        <input type="text" class="form-control" placeholder="Enter card number" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">RFID ID</label>
                                        <input type="text" class="form-control" placeholder="Enter RFID ID">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">DTU No.</label>
                                        <input type="text" class="form-control" placeholder="Enter DTU number">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Control</label>
                                        <input type="text" class="form-control" placeholder="Enter control info">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Module Id Start-stop</label>
                                    <input type="text" class="form-control" placeholder="Enter module ID">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">* Kart State</label>
                                    <div class="d-flex flex-wrap gap-2">
                                        <button type="button" class="btn btn-outline-success kart-state-btn" data-state="Empty">Empty</button>
                                        <button type="button" class="btn btn-outline-warning kart-state-btn" data-state="Using">Using</button>
                                        <button type="button" class="btn btn-outline-danger kart-state-btn" data-state="Repairing">Repairing</button>
                                        <button type="button" class="btn btn-outline-secondary kart-state-btn" data-state="Abandoned">Abandoned</button>
                                    </div>
                                    <input type="hidden" id="selected-kart-state" name="kart-state" required>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn_custom">Save changes</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add kart group -->
                <div class="modal fade" id="add_kart_group" aria-labelledby="addkartgroup" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="addkartgroup">Add Kart Group</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <input type="text" class="form-control" placeholder="Kart Group Name">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-large btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn_custom">Save changes</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Set Model Modal -->
                <div class="modal fade" id="set_model" aria-labelledby="setModelLabel" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-xl modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="setModelLabel">Set the brand and model</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body py-3">
                                <form id="brandModelForm">
                                    <div id="brandsContainer">
                                        <!-- First brand section will be added here -->
                                    </div>
                                    
                                    <!-- Add more brand button -->
                                    <div class="mt-3 text-center">
                                        <button type="button" class="btn btn-link text-info p-0" id="addMoreBrand">
                                            <i class="bi bi-plus-circle me-2"></i>Add more brand
                                        </button>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer border-0 pt-2">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn_custom" id="saveModelSettings">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>

        let brandCounter = 0;

        // Create a new brand section
        function createBrandSection() {
            brandCounter++;
            const brandSection = document.createElement('div');
            brandSection.className = 'brand-section';
            brandSection.id = `brand-section-${brandCounter}`;
            
            brandSection.innerHTML = `
                <div class="brand-header">
                    <h6 class="mb-0">Brand ${brandCounter}</h6>
                    ${brandCounter > 1 ? `<button type="button" class="btn btn-outline-danger btn-sm remove-brand-btn" onclick="removeBrandSection(${brandCounter})">
                        <i class="bi bi-trash"></i> Remove Brand
                    </button>` : ''}
                </div>
                
                <!-- Brand Input -->
                <div class="row align-items-center mb-4">
                    <div class="col-2">
                        <label class="form-label mb-0">Brand Name</label>
                    </div>
                    <div class="col-8">
                        <input type="text" class="form-control form-control-sm" name="brand_${brandCounter}" placeholder="Enter brand name" required>
                    </div>
                    <div class="col-2">
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearBrandInput(${brandCounter})">
                            <i class="bi bi-x-lg"></i>
                        </button>
                    </div>
                </div>
                
                <div class="results_table_wrapper">
                    <table class="table table-responsive">
                        <thead class="table table-dark">
                            <tr class="text-center">
                                <th>Model</th>
                                <th>Model Pic</th>
                                <th>Operation</th>
                            </tr>
                        </thead>
                        <tbody id="models-table-${brandCounter}">
                            <!-- Model rows will be added here -->
                        </tbody>                                    
                    </table>
                </div>
                
                <div class="text-end">
                    <button type="button" class="btn btn-outline-primary btn-sm" onclick="addModelRow(${brandCounter})">
                        <i class="bi bi-plus"></i> Add Model
                    </button>
                </div>
            `;
            
            return brandSection;
        }

        // Create a new model row
        function createModelRow(brandId, modelId) {
            return `
                <tr id="model-row-${brandId}-${modelId}">
                    <td class="text-center">
                        <div class="mt-2">
                            <input type="text" class="form-control form-control-sm" name="model_${brandId}_${modelId}" placeholder="Enter model name" required>
                        </div>
                    </td>
                    <td class="text-center">
                        <button type="button" class="btn btn-outline-secondary btn-sm upload-btn" onclick="triggerFileUpload(${brandId}, ${modelId})">
                            <i class="bi bi-upload"></i> Upload
                        </button>
                        <input type="file" class="d-none model-pic-input" id="modelPicInput-${brandId}-${modelId}" accept="image/*" onchange="handleFileUpload(${brandId}, ${modelId})">
                        <div class="upload-preview mt-2" id="preview-${brandId}-${modelId}" style="display: none;">
                            <img src="" alt="Preview" style="max-width: 80px; max-height: 60px; object-fit: cover;">
                        </div>
                    </td>
                    <td class="text-center">
                        <button type="button" class="btn btn-danger btn-sm" onclick="removeModelRow(${brandId}, ${modelId})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }

        // Add a new brand section
        function addBrandSection() {
            const brandsContainer = document.getElementById('brandsContainer');
            const brandSection = createBrandSection();
            brandsContainer.appendChild(brandSection);
            
            // Add initial model row
            addModelRow(brandCounter);
        }

        // Remove a brand section
        function removeBrandSection(brandId) {
            const brandSection = document.getElementById(`brand-section-${brandId}`);
            if (brandSection) {
                brandCounter--;
                brandSection.remove();
            }
        }

        // Clear brand input
        function clearBrandInput(brandId) {
            const input = document.querySelector(`input[name="brand_${brandId}"]`);
            if (input) {
                input.value = '';
            }
        }

        // Add a new model row to a specific brand
        function addModelRow(brandId) {
            const tableBody = document.getElementById(`models-table-${brandId}`);
            const modelId = Date.now(); // Use timestamp as unique ID
            const row = document.createElement('tr');
            row.innerHTML = createModelRow(brandId, modelId).replace(/<tr[^>]*>|<\/tr>/g, '');
            row.id = `model-row-${brandId}-${modelId}`;
            tableBody.appendChild(row);
        }

        // Remove a model row
        function removeModelRow(brandId, modelId) {
            const row = document.getElementById(`model-row-${brandId}-${modelId}`);
            if (row) {
                row.remove();
            }
        }

        // Trigger file upload
        function triggerFileUpload(brandId, modelId) {
            document.getElementById(`modelPicInput-${brandId}-${modelId}`).click();
        }

        // Handle file upload
        function handleFileUpload(brandId, modelId) {
            const input = document.getElementById(`modelPicInput-${brandId}-${modelId}`);
            const file = input.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(`preview-${brandId}-${modelId}`);
                    const img = preview.querySelector('img');
                    img.src = e.target.result;
                    preview.style.display = 'block';
                    
                    // Update upload button
                    const uploadBtn = input.parentNode.querySelector('.upload-btn');
                    uploadBtn.innerHTML = '<i class="bi bi-arrow-repeat"></i> Change';
                };
                reader.readAsDataURL(file);
            }
        }

        // Save form data
        function saveModelSettings() {
            const form = document.getElementById('brandModelForm');
            const formData = new FormData(form);
            
            // Collect all data
            const brandsData = [];
            const brandSections = document.querySelectorAll('.brand-section');
            
            brandSections.forEach((section) => {
                const brandId = section.id.split('-')[2];
                const brandName = section.querySelector(`input[name="brand_${brandId}"]`).value;
                
                if (brandName.trim()) {
                    const models = [];
                    const modelRows = section.querySelectorAll(`#models-table-${brandId} tr`);
                    
                    modelRows.forEach((row) => {
                        const modelInput = row.querySelector('input[type="text"]');
                        const fileInput = row.querySelector('input[type="file"]');
                        
                        if (modelInput && modelInput.value.trim()) {
                            models.push({
                                name: modelInput.value.trim(),
                                hasImage: fileInput && fileInput.files.length > 0
                            });
                        }
                    });
                    
                    brandsData.push({
                        name: brandName.trim(),
                        models: models
                    });
                }
            });
            // Can send data to server here

            console.log('Brands Data:', brandsData);
            alert('Data saved! Check console for details.');
        }

        // Initialize the modal
        document.addEventListener('DOMContentLoaded', function() {
            // Add initial brand section when modal opens
            document.getElementById('set_model').addEventListener('show.bs.modal', function() {
                if (document.querySelectorAll('.brand-section').length === 0) {
                    addBrandSection();
                }
            });
            
            // Add more brand button
            document.getElementById('addMoreBrand').addEventListener('click', addBrandSection);
            
            // Save button
            document.getElementById('saveModelSettings').addEventListener('click', saveModelSettings);
        });

        function toggleGroup(header) {
            const groupItems = header.nextElementSibling;
            const isCollapsed = header.classList.contains('collapsed');
            
            if (isCollapsed) {
                header.classList.remove('collapsed');
                groupItems.classList.remove('collapsed');
            } else {
                header.classList.add('collapsed');
                groupItems.classList.add('collapsed');
            }
        }
        // Live Clock
        function updateClock() {
            const now = new Date();
            const dateStr = now.toLocaleDateString("en-US", { year: "numeric", month: "long", day: "numeric" });
            const timeStr = now.toLocaleTimeString("en-US", { hour12: false });
            document.getElementById("date").textContent = dateStr;
            document.getElementById("clock").textContent = timeStr;
        }
        setInterval(updateClock, 1000);
        updateClock();
    </script>
</body>
</html>